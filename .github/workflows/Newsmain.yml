name: Generate Economic Calendar with News

on:
  workflow_dispatch:  # Manual trigger
  schedule:
    - cron: '0 0 1 * *'  # Run monthly on the 1st at midnight UTC

jobs:
  generate-calendar:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas requests
    
    - name: Run calendar generator
      run: |
        python economic_calendar_generator.py <<EOF
        y
        EOF
      timeout-minutes: 45
    
    - name: List generated files
      run: |
        echo "Generated files:"
        ls -lh *.json *.csv 2>/dev/null || echo "No files generated"
    
    - name: Upload JSON artifact
      uses: actions/upload-artifact@v4
      with:
        name: economic-calendar-json
        path: economic_calendar_*_with_news.json
        retention-days: 90
    
    - name: Upload CSV artifact
      uses: actions/upload-artifact@v4
      with:
        name: economic-calendar-csv
        path: economic_calendar_*_with_news.csv
        retention-days: 90
    
    - name: Create summary
      run: |
        echo "## Economic Calendar Generated âœ…" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Files Created:" >> $GITHUB_STEP_SUMMARY
        echo "- JSON: \`economic_calendar_2001_2026_with_news.json\`" >> $GITHUB_STEP_SUMMARY
        echo "- CSV: \`economic_calendar_2001_2026_with_news.csv\`" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ -f "economic_calendar_2001_2026_with_news.json" ]; then
          FILE_SIZE=$(ls -lh economic_calendar_2001_2026_with_news.json | awk '{print $5}')
          echo "- JSON File Size: $FILE_SIZE" >> $GITHUB_STEP_SUMMARY
        fi
        if [ -f "economic_calendar_2001_2026_with_news.csv" ]; then
          FILE_SIZE=$(ls -lh economic_calendar_2001_2026_with_news.csv | awk '{print $5}')
          ROWS=$(wc -l < economic_calendar_2001_2026_with_news.csv)
          echo "- CSV File Size: $FILE_SIZE" >> $GITHUB_STEP_SUMMARY
          echo "- CSV Rows: $ROWS" >> $GITHUB_STEP_SUMMARY
        fi
